# Migration `20201018115218-removed-3rd-normalization-tables`

This migration has been generated by Jack Tan at 10/19/2020, 12:52:18 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."recipe_adjectives" DROP CONSTRAINT "recipe_adjectives_recipe_id_fkey"

ALTER TABLE "public"."recipe_adjectives" DROP CONSTRAINT "recipe_adjectives_type_fkey"

ALTER TABLE "public"."recipe_allergies" DROP CONSTRAINT "recipe_allergies_recipe_id_fkey"

ALTER TABLE "public"."recipe_allergies" DROP CONSTRAINT "recipe_allergies_type_fkey"

ALTER TABLE "public"."recipe_cuisines" DROP CONSTRAINT "recipe_cuisines_recipe_id_fkey"

ALTER TABLE "public"."recipe_cuisines" DROP CONSTRAINT "recipe_cuisines_type_fkey"

ALTER TABLE "public"."recipe_diets" DROP CONSTRAINT "recipe_diets_recipe_id_fkey"

ALTER TABLE "public"."recipe_diets" DROP CONSTRAINT "recipe_diets_type_fkey"

ALTER TABLE "public"."recipe_meals" DROP CONSTRAINT "recipe_meals_meals_id_fkey"

ALTER TABLE "public"."recipe_meals" DROP CONSTRAINT "recipe_meals_recipe_id_fkey"

ALTER TABLE "public"."user_allergies" DROP CONSTRAINT "user_allergies_type_fkey"

ALTER TABLE "public"."user_allergies" DROP CONSTRAINT "user_allergies_user_id_fkey"

ALTER TABLE "public"."user_diets" DROP CONSTRAINT "user_diets_type_fkey"

ALTER TABLE "public"."user_diets" DROP CONSTRAINT "user_diets_user_id_fkey"

ALTER TABLE "public"."user_pantries" DROP CONSTRAINT "user_pantries_name_fkey"

ALTER TABLE "public"."user_pantries" DROP CONSTRAINT "user_pantries_user_id_fkey"

ALTER TABLE "public"."user_saved_recipes" DROP CONSTRAINT "user_saved_recipes_recipe_id_fkey"

ALTER TABLE "public"."user_saved_recipes" DROP CONSTRAINT "user_saved_recipes_user_id_fkey"

ALTER TABLE "public"."ingredients" ADD COLUMN "usersId" integer   

ALTER TABLE "public"."recipes" ADD COLUMN "usersId" integer   

ALTER TABLE "public"."users" ADD COLUMN "user_allergies" "Allergy"[]  ,
ADD COLUMN "user_diets" "Diet"[]  

ALTER TABLE "public"."ingredients" ADD FOREIGN KEY ("usersId")REFERENCES "public"."users"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."recipes" ADD FOREIGN KEY ("usersId")REFERENCES "public"."users"("id") ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE "public"."adjectives"

DROP TABLE "public"."allergies"

DROP TABLE "public"."cuisines"

DROP TABLE "public"."diets"

DROP TABLE "public"."meals"

DROP TABLE "public"."recipe_adjectives"

DROP TABLE "public"."recipe_allergies"

DROP TABLE "public"."recipe_cuisines"

DROP TABLE "public"."recipe_diets"

DROP TABLE "public"."recipe_meals"

DROP TABLE "public"."user_allergies"

DROP TABLE "public"."user_diets"

DROP TABLE "public"."user_pantries"

DROP TABLE "public"."user_saved_recipes"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201018112809-recipes-use-enum..20201018115218-removed-3rd-normalization-tables
--- datamodel.dml
+++ datamodel.dml
@@ -3,97 +3,11 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
-model adjectives {
-  type              String              @id
-  recipe_adjectives recipe_adjectives[]
-}
-
-model allergies {
-  type             String             @id
-  recipe_allergies recipe_allergies[]
-  user_allergies   user_allergies[]
-}
-
-model cuisines {
-  type            String            @id
-  recipe_cuisines recipe_cuisines[]
-}
-
-model meals {
-  id           Int            @id @default(autoincrement())
-  name         String
-  recipe_meals recipe_meals[]
-}
-
-model diets {
-  type         String         @id
-  recipe_diets recipe_diets[]
-  user_diets   user_diets[]
-}
-
-model ingredients {
-  name               String               @id
-  price_currency     String
-  price_amount       Float
-  recipe_ingredients recipe_ingredients[]
-  user_pantries      user_pantries[]
-}
-
-model recipe_adjectives {
-  id         Int         @id @default(autoincrement())
-  recipe_id  Int?
-  type       String?
-  adjectives adjectives? @relation(fields: [type], references: [type])
-  recipes    recipes?    @relation(fields: [recipe_id], references: [id])
-}
-
-model recipe_allergies {
-  id        Int        @id @default(autoincrement())
-  recipe_id Int?
-  type      String?
-  allergies allergies? @relation(fields: [type], references: [type])
-  recipes   recipes?   @relation(fields: [recipe_id], references: [id])
-}
-
-model recipe_cuisines {
-  id        Int       @id @default(autoincrement())
-  recipe_id Int?
-  type      String?
-  cuisines  cuisines? @relation(fields: [type], references: [type])
-  recipes   recipes?  @relation(fields: [recipe_id], references: [id])
-}
-
-model recipe_diets {
-  id        Int      @id @default(autoincrement())
-  recipe_id Int?
-  type      String?
-  diets     diets?   @relation(fields: [type], references: [type])
-  recipes   recipes? @relation(fields: [recipe_id], references: [id])
-}
-
-model recipe_ingredients {
-  recipe_link     String
-  ingredient_name String
-  quantity        Float
-  ingredients     ingredients @relation(fields: [ingredient_name], references: [name])
-  recipes         recipes     @relation(fields: [recipe_link], references: [link])
-
-  @@id([recipe_link, ingredient_name])
-}
-
-model recipe_meals {
-  id        Int      @id @default(autoincrement())
-  recipe_id Int?
-  meals_id  Int?
-  meals     meals?   @relation(fields: [meals_id], references: [id])
-  recipes   recipes? @relation(fields: [recipe_id], references: [id])
-}
-
 enum Cuisine {
   AMERICAN
   ITALIAN
   ASIAN
@@ -150,8 +64,27 @@
   LUNCH
   DINNER
 }
+model ingredients {
+  name               String               @id
+  price_currency     String
+  price_amount       Float
+  recipe_ingredients recipe_ingredients[]
+  users              users?               @relation(fields: [usersId], references: [id])
+  usersId            Int?
+}
+
+model recipe_ingredients {
+  recipe_link     String
+  ingredient_name String
+  quantity        Float
+  ingredients     ingredients @relation(fields: [ingredient_name], references: [name])
+  recipes         recipes     @relation(fields: [recipe_link], references: [link])
+
+  @@id([recipe_link, ingredient_name])
+}
+
 model recipes {
   id                 Int                  @id @default(autoincrement())
   name               String
   link               String               @unique
@@ -163,51 +96,20 @@
   recipe_cuisines    Cuisine[]
   recipe_diets       Diet[]
   recipe_meals       Meal[]
   recipe_ingredients recipe_ingredients[]
-  user_saved_recipes user_saved_recipes[]
+  users              users?               @relation(fields: [usersId], references: [id])
+  usersId            Int?
 }
-model user_allergies {
-  id        Int        @id @default(autoincrement())
-  user_id   Int?
-  type      String?
-  allergies allergies? @relation(fields: [type], references: [type])
-  users     users?     @relation(fields: [user_id], references: [id])
-}
-
-model user_diets {
-  id      Int     @id @default(autoincrement())
-  user_id Int?
-  type    String?
-  diets   diets?  @relation(fields: [type], references: [type])
-  users   users?  @relation(fields: [user_id], references: [id])
-}
-
-model user_pantries {
-  id          Int          @id @default(autoincrement())
-  user_id     Int?
-  name        String?
-  ingredients ingredients? @relation(fields: [name], references: [name])
-  users       users?       @relation(fields: [user_id], references: [id])
-}
-
-model user_saved_recipes {
-  id        Int      @id @default(autoincrement())
-  user_id   Int?
-  recipe_id Int?
-  recipes   recipes? @relation(fields: [recipe_id], references: [id])
-  users     users?   @relation(fields: [user_id], references: [id])
-}
-
 model users {
-  id                 Int                  @id @default(autoincrement())
-  google_id          String?              @unique
-  facebook_id        String?              @unique
-  email              String               @unique
+  id                 Int           @id @default(autoincrement())
+  google_id          String?       @unique
+  facebook_id        String?       @unique
+  email              String        @unique
   password           String?
   nickname           String?
-  user_allergies     user_allergies[]
-  user_diets         user_diets[]
-  user_pantries      user_pantries[]
-  user_saved_recipes user_saved_recipes[]
+  user_allergies     Allergy[]
+  user_diets         Diet[]
+  user_pantries      ingredients[]
+  user_saved_recipes recipes[]
 }
```


