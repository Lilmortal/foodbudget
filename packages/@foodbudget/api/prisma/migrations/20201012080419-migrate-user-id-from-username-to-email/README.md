# Migration `20201012080419-migrate-user-id-from-username-to-email`

This migration has been generated by Jack Tan at 10/12/2020, 9:04:19 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."user_allergies" DROP CONSTRAINT "user_allergies_user_id_fkey"

ALTER TABLE "public"."user_diets" DROP CONSTRAINT "user_diets_user_id_fkey"

ALTER TABLE "public"."user_pantries" DROP CONSTRAINT "user_pantries_user_id_fkey"

ALTER TABLE "public"."user_saved_recipes" DROP CONSTRAINT "user_saved_recipes_user_id_fkey"

ALTER TABLE "public"."user_allergies" DROP COLUMN "user_id",
ADD COLUMN "user_email" text   

ALTER TABLE "public"."user_diets" DROP COLUMN "user_id",
ADD COLUMN "user_email" text   

ALTER TABLE "public"."user_pantries" DROP COLUMN "user_id",
ADD COLUMN "user_email" text   

ALTER TABLE "public"."user_saved_recipes" DROP COLUMN "user_id",
ADD COLUMN "user_email" text   

ALTER TABLE "public"."users" DROP CONSTRAINT "users_pkey",
DROP COLUMN "username",
ADD COLUMN "email" text   NOT NULL ,
ADD PRIMARY KEY ("email")

ALTER TABLE "public"."user_allergies" ADD FOREIGN KEY ("user_email")REFERENCES "public"."users"("email") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."user_diets" ADD FOREIGN KEY ("user_email")REFERENCES "public"."users"("email") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."user_pantries" ADD FOREIGN KEY ("user_email")REFERENCES "public"."users"("email") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."user_saved_recipes" ADD FOREIGN KEY ("user_email")REFERENCES "public"."users"("email") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200919071458-unique-recipe-links..20201012080419-migrate-user-id-from-username-to-email
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model adjectives {
   adjectives_type   String              @id
@@ -93,40 +93,40 @@
 }
 model user_allergies {
   id           Int        @id @default(autoincrement())
-  user_id      String?
+  user_email   String?
   allergy_type String?
   allergies    allergies? @relation(fields: [allergy_type], references: [allergy_type])
-  users        users?     @relation(fields: [user_id], references: [username])
+  users        users?     @relation(fields: [user_email], references: [email])
 }
 model user_diets {
-  id        Int     @id @default(autoincrement())
-  user_id   String?
-  diet_type String?
-  diets     diets?  @relation(fields: [diet_type], references: [diet_type])
-  users     users?  @relation(fields: [user_id], references: [username])
+  id         Int     @id @default(autoincrement())
+  user_email String?
+  diet_type  String?
+  diets      diets?  @relation(fields: [diet_type], references: [diet_type])
+  users      users?  @relation(fields: [user_email], references: [email])
 }
 model user_pantries {
   id              Int          @id @default(autoincrement())
-  user_id         String?
+  user_email      String?
   ingredient_name String?
   ingredients     ingredients? @relation(fields: [ingredient_name], references: [ingredient_name])
-  users           users?       @relation(fields: [user_id], references: [username])
+  users           users?       @relation(fields: [user_email], references: [email])
 }
 model user_saved_recipes {
-  id        Int      @id @default(autoincrement())
-  user_id   String?
-  recipe_id Int?
-  recipes   recipes? @relation(fields: [recipe_id], references: [id])
-  users     users?   @relation(fields: [user_id], references: [username])
+  id         Int      @id @default(autoincrement())
+  user_email String?
+  recipe_id  Int?
+  recipes    recipes? @relation(fields: [recipe_id], references: [id])
+  users      users?   @relation(fields: [user_email], references: [email])
 }
 model users {
-  username           String               @id
+  email              String               @id
   password           String
   nickname           String
   user_allergies     user_allergies[]
   user_diets         user_diets[]
```


