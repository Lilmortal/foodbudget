# Migration `20201018071523-recipe-ingredients-id-change-to-recipe-link-and-ingredient-name`

This migration has been generated by Jack Tan at 10/18/2020, 8:15:23 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."recipe_ingredients" DROP CONSTRAINT "recipe_ingredients_name_fkey"

ALTER TABLE "public"."recipe_ingredients" DROP CONSTRAINT "recipe_ingredients_recipe_id_fkey"

ALTER TABLE "public"."recipe_ingredients" DROP CONSTRAINT "recipe_ingredients_pkey",
DROP COLUMN "id",
DROP COLUMN "recipe_id",
DROP COLUMN "name",
ADD COLUMN "recipe_link" text   NOT NULL ,
ADD COLUMN "ingredient_name" text   NOT NULL ,
ADD PRIMARY KEY ("recipe_link", "ingredient_name")

ALTER TABLE "public"."recipe_ingredients" ADD FOREIGN KEY ("ingredient_name")REFERENCES "public"."ingredients"("name") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."recipe_ingredients" ADD FOREIGN KEY ("recipe_link")REFERENCES "public"."recipes"("link") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201017011451-add-recipe-meals..20201018071523-recipe-ingredients-id-change-to-recipe-link-and-ingredient-name
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model adjectives {
   type              String              @id
@@ -75,14 +75,15 @@
   recipes   recipes? @relation(fields: [recipe_id], references: [id])
 }
 model recipe_ingredients {
-  id          Int          @id @default(autoincrement())
-  recipe_id   Int?
-  name        String?
-  quantity    Float
-  ingredients ingredients? @relation(fields: [name], references: [name])
-  recipes     recipes?     @relation(fields: [recipe_id], references: [id])
+  recipe_link     String
+  ingredient_name String
+  quantity        Float
+  ingredients     ingredients @relation(fields: [ingredient_name], references: [name])
+  recipes         recipes     @relation(fields: [recipe_link], references: [link])
+
+  @@id([recipe_link, ingredient_name])
 }
 model recipe_meals {
   id        Int      @id @default(autoincrement())
```


