# Migration `20201013013140-add-user-id`

This migration has been generated by Jack Tan at 10/13/2020, 2:31:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."user_allergies" DROP CONSTRAINT "user_allergies_user_email_fkey"

ALTER TABLE "public"."user_diets" DROP CONSTRAINT "user_diets_user_email_fkey"

ALTER TABLE "public"."user_pantries" DROP CONSTRAINT "user_pantries_user_email_fkey"

ALTER TABLE "public"."user_saved_recipes" DROP CONSTRAINT "user_saved_recipes_user_email_fkey"

ALTER TABLE "public"."user_allergies" DROP COLUMN "user_email",
ADD COLUMN "user_id" integer   

ALTER TABLE "public"."user_diets" DROP COLUMN "user_email",
ADD COLUMN "user_id" integer   

ALTER TABLE "public"."user_pantries" DROP COLUMN "user_email",
ADD COLUMN "user_id" integer   

ALTER TABLE "public"."user_saved_recipes" DROP COLUMN "user_email",
ADD COLUMN "user_id" integer   

ALTER TABLE "public"."users" DROP CONSTRAINT "users_pkey",
ADD COLUMN "id" SERIAL,
ADD PRIMARY KEY ("id")

CREATE UNIQUE INDEX "users.email_unique" ON "public"."users"("email")

ALTER TABLE "public"."user_allergies" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."user_diets" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."user_pantries" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."user_saved_recipes" ADD FOREIGN KEY ("user_id")REFERENCES "public"."users"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201012080419-migrate-user-id-from-username-to-email..20201013013140-add-user-id
--- datamodel.dml
+++ datamodel.dml
@@ -3,9 +3,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model adjectives {
   adjectives_type   String              @id
@@ -93,40 +93,41 @@
 }
 model user_allergies {
   id           Int        @id @default(autoincrement())
-  user_email   String?
+  user_id      Int?
   allergy_type String?
   allergies    allergies? @relation(fields: [allergy_type], references: [allergy_type])
-  users        users?     @relation(fields: [user_email], references: [email])
+  users        users?     @relation(fields: [user_id], references: [id])
 }
 model user_diets {
-  id         Int     @id @default(autoincrement())
-  user_email String?
-  diet_type  String?
-  diets      diets?  @relation(fields: [diet_type], references: [diet_type])
-  users      users?  @relation(fields: [user_email], references: [email])
+  id        Int     @id @default(autoincrement())
+  user_id   Int?
+  diet_type String?
+  diets     diets?  @relation(fields: [diet_type], references: [diet_type])
+  users     users?  @relation(fields: [user_id], references: [id])
 }
 model user_pantries {
   id              Int          @id @default(autoincrement())
-  user_email      String?
+  user_id         Int?
   ingredient_name String?
   ingredients     ingredients? @relation(fields: [ingredient_name], references: [ingredient_name])
-  users           users?       @relation(fields: [user_email], references: [email])
+  users           users?       @relation(fields: [user_id], references: [id])
 }
 model user_saved_recipes {
-  id         Int      @id @default(autoincrement())
-  user_email String?
-  recipe_id  Int?
-  recipes    recipes? @relation(fields: [recipe_id], references: [id])
-  users      users?   @relation(fields: [user_email], references: [email])
+  id        Int      @id @default(autoincrement())
+  user_id   Int?
+  recipe_id Int?
+  recipes   recipes? @relation(fields: [recipe_id], references: [id])
+  users     users?   @relation(fields: [user_id], references: [id])
 }
 model users {
-  email              String               @id
+  id                 Int                  @id @default(autoincrement())
+  email              String               @unique
   password           String
   nickname           String
   user_allergies     user_allergies[]
   user_diets         user_diets[]
```


